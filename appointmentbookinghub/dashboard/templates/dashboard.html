{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-base-200 p-10">
    <div class="max-w-6xl mx-auto">
        
        <div class="navbar bg-base-100 shadow-xl rounded-box mb-6">
            <div class="navbar-start">
                <h1 class="text-xl font-bold">Appointment Hub</h1>
            </div>
            <div class="navbar-center">
                <div class="tabs tabs-boxed">
                    <a class="tab tab-active">Dashboard</a>
                    {% if user.role == "patient" %}
                        <a class="tab" href="/specialists/">Specialists</a>
                    {% endif %}
                </div>
            </div>
            <div class="navbar-end">
                <div class="dropdown dropdown-end">
                    <div tabindex="0" role="button" class="btn btn-ghost">
                        {{ user.username }}
                        <div class="badge badge-sm badge-outline">{{ user.role }}</div>
                    </div>
                    <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow">
                        <li>
                            <form method="post" action="{% url 'logout' %}">
                                {% csrf_token %}
                                <button type="submit" class="w-full text-left">Logout</button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        {% if user.role == "patient" %}
            <div class="grid lg:grid-cols-3 gap-6">
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-primary">Quick Actions</h2>
                        <div class="card-actions flex-col gap-3">
                            <a href="/specialists/" class="btn btn-primary btn-block">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                Book Appointment
                            </a>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h2 class="card-title text-primary">Your Appointments</h2>
                            {% if patient_bookings %}
                                <div class="overflow-x-auto">
                                    <table class="table table-zebra">
                                        <thead>
                                            <tr>
                                                <th>Specialist</th>
                                                <th>Date & Time</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for booking in patient_bookings %}
                                            <tr>
                                                <td>
                                                    <div>
                                                        <div class="font-bold">{{ booking.specialist.user.username }}</div>
                                                        <div class="text-sm opacity-50">{{ booking.specialist.specialty }}</div>
                                                    </div>
                                                </td>
                                                <td>{{ booking.start_time|date:"M d, Y" }} at {{ booking.start_time|time:"g:i A" }}</td>
                                                <td>
                                                    <div class="badge {% if booking.status == 'confirmed' %}badge-success{% elif booking.status == 'pending' %}badge-warning{% else %}badge-error{% endif %}">
                                                        {{ booking.status|title }}
                                                    </div>
                                                </td>
                                                <td>
                                                    {% if booking.status == 'pending' %}
                                                        <button class="btn btn-sm btn-error">Cancel</button>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="alert alert-info">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>No appointments yet. <a href="/specialists/" class="link">Book your first appointment!</a></span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        {% if user.role == "specialist" %}
            <div class="grid gap-6">
                <div class="stats stats-vertical lg:stats-horizontal shadow">
                    <div class="stat">
                        <div class="stat-figure text-warning">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="stat-title">Pending Appointments</div>
                        <div class="stat-value text-warning">{{ pending_count }}</div>
                        <div class="stat-desc">Awaiting confirmation</div>
                    </div>
                    
                    <div class="stat">
                        <div class="stat-figure text-success">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                        </div>
                        <div class="stat-title">Confirmed</div>
                        <div class="stat-value text-success">{{ confirmed_count|default:0 }}</div>
                        <div class="stat-desc">This week</div>
                    </div>
                    
                    <div class="stat">
                        <div class="stat-figure text-info">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 002 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <div class="stat-title">Total Bookings</div>
                        <div class="stat-value text-info">{{ total_count|default:0 }}</div>
                        <div class="stat-desc">All time</div>
                    </div>
                </div>

                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title text-primary">Recent Bookings</h2>
                            {% if specialist_bookings %}
                                <div class="overflow-x-auto">
                                    <table class="table table-zebra">
                                        <thead>
                                            <tr>
                                                <th>Patient</th>
                                                <th>Date & Time</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for booking in specialist_bookings %}
                                            <tr>
                                                <td>
                                                    <div class="font-bold">{{ booking.patient.user.username }}</div>
                                                </td>
                                                <td>{{ booking.start_time|date:"M d, Y" }} at {{ booking.start_time|time:"g:i A" }}</td>
                                                <td>
                                                    <div class="badge {% if booking.status == 'confirmed' %}badge-success{% elif booking.status == 'pending' %}badge-warning{% else %}badge-error{% endif %}">
                                                        {{ booking.status|title }}
                                                    </div>
                                                </td>
                                                <td>
                                                    {% if booking.status == 'pending' %}
                                                        <div class="btn-group">
                                                            <button class="btn btn-sm btn-success"
                                                                    hx-post="/bookings/{{ booking.id }}/confirm/"
                                                                    hx-target="closest tr"
                                                                    hx-swap="outerHTML">
                                                                Confirm
                                                            </button>
                                                            <button class="btn btn-sm btn-error"
                                                                    hx-post="/bookings/{{ booking.id }}/cancel/"
                                                                    hx-target="closest tr"
                                                                    hx-swap="outerHTML">
                                                                Cancel
                                                            </button>
                                                        </div>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="alert alert-info">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>No bookings yet. Patients will see your profile when you set your availability.</span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="card bg-base-100 shadow-xl mt-4">
                        <div class="card-body">
                            <h2 class="card-title text-primary">Quick Actions</h2>
                            <div class="card-actions gap-3">
                                <button class="btn btn-primary">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Manage Availability
                                </button>
                                <button class="btn btn-outline">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                    Update Profile
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

    </div>
</div>

<meta name="csrf-token" content="{{ csrf_token }}">
{% csrf_token %}
{% endblock %}
